<UserControl x:Class="Axon.UI.Components.AxonTextBox"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             x:Name="AxonTextBoxControl">

    <UserControl.Resources>
        <!-- Estilo para el TextBox interno -->
        <Style x:Key="AxonInternalTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="{DynamicResource ColorNeutralForeground1Brush}"/>
            <Setter Property="CaretBrush" Value="{DynamicResource ColorBrandForeground1Brush}"/>
            <Setter Property="SelectionBrush" Value="{DynamicResource ColorBrandBackground2Brush}"/>
            <Setter Property="FontWeight" Value="{StaticResource FontWeightSemibold}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                SnapsToDevicePixels="True">
                            <ScrollViewer x:Name="PART_ContentHost"
                                        Focusable="False"
                                        HorizontalScrollBarVisibility="Hidden"
                                        VerticalScrollBarVisibility="Hidden"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Storyboards para animaciones -->
        <Storyboard x:Key="FocusedStoryboard">
            <DoubleAnimation Storyboard.TargetName="FocusLineScale"
                           Storyboard.TargetProperty="ScaleX"
                           To="1"
                           Duration="0:0:0.2"/>
            <DoubleAnimation Storyboard.TargetName="FocusLine"
                           Storyboard.TargetProperty="Opacity"
                           To="1"
                           Duration="0:0:0.2"/>
        </Storyboard>

        <Storyboard x:Key="UnfocusedStoryboard">
            <DoubleAnimation Storyboard.TargetName="FocusLineScale"
                           Storyboard.TargetProperty="ScaleX"
                           To="0"
                           Duration="0:0:0.2"/>
            <DoubleAnimation Storyboard.TargetName="FocusLine"
                           Storyboard.TargetProperty="Opacity"
                           To="0"
                           Duration="0:0:0.2"/>
        </Storyboard>
    </UserControl.Resources>

    <Grid MinHeight="40">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Label superior -->
        <TextBlock x:Name="LabelTextBlock"
                   Height="{StaticResource FontSizeBase600}"
                   Grid.Row="0"
                   Text="{Binding Label, ElementName=AxonTextBoxControl}"
                   FontSize="{StaticResource FontSizeBase300}"
                   Foreground="{DynamicResource ColorNeutralForeground2Brush}"
                   Margin="0,0,0,0"
                   Visibility="{Binding HasLabel, ElementName=AxonTextBoxControl, Converter={StaticResource BooleanToVisibilityConverter}}"/>

        <!-- Contenedor principal del TextBox y unidades -->
        <Border x:Name="MainBorder"
                Grid.Row="1"
                Background="{DynamicResource ColorNeutralBackground1Brush}"
                BorderBrush="{DynamicResource ColorNeutralStroke2Brush}"
                BorderThickness="1,1,1,1.5"
                Padding="0"
                MinHeight="32">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- TextBox principal -->
                <TextBox x:Name="MainTextBox"
                         Grid.Column="0"
                         Style="{StaticResource AxonInternalTextBoxStyle}"
                         Text="{Binding Text, ElementName=AxonTextBoxControl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         IsReadOnly="{Binding IsReadOnly, ElementName=AxonTextBoxControl}"
                         IsEnabled="{Binding IsEnabled, ElementName=AxonTextBoxControl}"
                         GotFocus="MainTextBox_GotFocus"
                         LostFocus="MainTextBox_LostFocus"
                         TextChanged="MainTextBox_TextChanged"
                         Margin="4,0"/>

                <!-- Unidades -->
                <TextBlock x:Name="UnitsTextBlock"
                           Grid.Column="1"
                           Text="{Binding Units, ElementName=AxonTextBoxControl}"
                           FontSize="{StaticResource FontSizeBase200}"
                           Foreground="{DynamicResource ColorNeutralForeground3Brush}"
                           VerticalAlignment="Center"
                           Margin="8,0,4,0"
                           Visibility="{Binding HasUnits, ElementName=AxonTextBoxControl, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            </Grid>
        </Border>

        <!-- Línea de foco (estilo Windows) -->
        <Rectangle x:Name="FocusLine"
                   Grid.Row="2"
                   Height="1.5"
                   Fill="{DynamicResource ColorBrandBackgroundBrush}"
                   HorizontalAlignment="Stretch"
                   Opacity="0"
                   RenderTransformOrigin="0.5,0.5">
            <Rectangle.RenderTransform>
                <ScaleTransform x:Name="FocusLineScale" ScaleX="0"/>
            </Rectangle.RenderTransform>
        </Rectangle>
    </Grid>
</UserControl>